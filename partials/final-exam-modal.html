---
layout: raw
permalink: /partials/final-exam-modal/
---
<style>

.message {
  color: #333;
  text-align: center;
  padding: 1.8em;
  border: 1.2em solid #444;
  border-radius: 2px;
  margin-top: 1.8em;
  margin-bottom: 1.8em;
}

.message h2 {
  font: 900 1.8em/1.1 brandon-grotesque, "Helvetica Neue", Helvetica, sans-serif;
  text-transform: uppercase;
  letter-spacing: .03em;
  text-align: center;
  margin-bottom: .8em;
}

.message p {
  font-family: brandon-grotesque, "Helvetica Neue", Helvetica, sans-serif;
  font-size: 1.2em;
  line-height: 1.5;
}

.message h2 + p {
  font-size: 1.4em;
}

.message p {
  text-align: left;
  margin-top: .6em;
}

.message hr {
  height: 0;
  border: 0;
  border-top: 1px solid #ddd;
  margin-top: 1.4em;
}

.message .survey {
  display: inline-block;
  background: #ebebeb;
  padding: 1.2em;
  border: 1px solid #ccc;
  margin-top: 1.4em;
}

.message .survey p {
  margin-top: 0;
}

.message .gym-button {
  margin-top: 1.2em;
}

a.gym-button-primary {
  display: inline-block;
  font: bold 1.2em/1 brandon-grotesque, "Helvetica Neue", Helvetica, sans-serif;
  color: #fff;
  letter-spacing: .025em;
  vertical-align: normal;
  background: #f8971d;
  padding: 1em 2em;
  border: 0;
  border-radius: 2px;
  margin-top: .5em;
  margin-right: .84em;
  margin-bottom: .5em;
  cursor: pointer;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: auto !important;
  }

a.gym-button-primary:hover {
  background: #a6a6a6;
}

a.gym-button.gym-button-secondary {
  color: #333;
  background: none;
  border: 2px solid #333;
  width: auto !important;
}

a.gym-button.gym-button-secondary:hover,
a.gym-button.gym-button-secondary:focus {
  color: #fff !important;
  background: #a6a6a6 !important;
  border: 2px solid #333 !important;
}

</style>

<main role="main">
  <div class="message hidden passed_modal final-exam-status FULL_COURSE" aria-hidden="true" id="course_passed_message">
    <h2>Congratulations!</h2>
    <p>Congrats on completing the course and passing the final exam.</p>
    <p><strong>You really know your stuff!</strong> Now show off to your network by sharing your certificate on LinkedIn. You can access it right from your <a href="/dashboard">Dashboard</a>.</p>
    <a class="btn gym-button gym-button-primary" href="/dashboard">View Your Certificate</a>
    <div class="survey">
      <p>Before you go, would you mind taking a sec to fill out our quick survey? Your feedback will help shape future courses and let us know how <em>we’re</em> doing.</p>
      <a class="gym-button gym-button-secondary" href="https://www.surveymonkey.com/s/JYJPMSS" target="_blank">Take Our Survey</a>
    </div>
  </div>

  <div class="message hidden passed_modal final-exam-status GYM_SHORT" aria-hidden="true" id="course_passed_message">
    <h2>Congratulations!</h2>
    <p>Congrats on completing the course and passing the final exam.</p>
    <p><strong>You really know your stuff!</strong> Now show off to your network by sharing your badge on LinkedIn. You can access it right from your <a href="/dashboard">Dashboard</a>.</p>
    <a class="btn gym-button gym-button-primary" href="/dashboard">View Your Badge</a>
    <div class="survey">
      <p>Before you go, would you mind taking a sec to fill out our quick survey? Your feedback will help shape future courses and let us know how <em>we’re</em> doing.</p>
      <a class="gym-button gym-button-secondary" href="https://www.surveymonkey.com/s/JYJPMSS" target="_blank">Take Our Survey</a>
    </div>
  </div>

  <div class="message hidden try_again_modal final-exam-status GYM_SHORT" aria-hidden="true">
    <h2>You’re Close!</h2>
    <p>We’re thrilled you’ve made it this far. You’ve scored a <span  class="exam-score-container"></span> on the exam. To pass you need to get greater than an 80.</p>

    <p>Lucky for you, you’ve still got one more chance to pass. This would be a great time to go back and review the course material. Take a look at things you may have struggled with and have another go when you feel prepared. </p>

    <p>Good luck!</p>
  </div>

  <div class="message hidden try_again_modal final-exam-status FULL_COURSE" aria-hidden="true">
    <h2>You’re close!</h2>
    <p>We’re thrilled you’ve made it this far. You’ve scored a <span class="exam-score-container"></span> on the exam. To pass you need to get greater than an 85.</p>

    <p>Lucky for you, you’ve still got one more chance to pass. This would be a great time to go back and review the course material. Then try again when you feel prepared.</p>
    <p>Good luck!</p>
  </div>

  <div class="message hidden failed_modal final-exam-status" aria-hidden="true">
    <h2>Aw, shucks.</h2>
    <p>Unfortunately, you’ve run out of chances to pass. You still deserve a lot of credit for finishing our course! Only 1 in 10 online learners actually completes a course.</p>

    <div class="survey">
      <p>Could you please take a moment to share your thoughts with us on a quick survey? Your feedback will help shape our future courses and let us know how <em>we’re</em> doing.</p>
      <a class="gym-button gym-button-primary" href="https://www.surveymonkey.com/s/JYJPMSS" target="_blank">
        Take Our Survey
      </a>
    </div>
  </div>
</main>

{%- comment -%}
Adding exam script here for proper inlining
{%- endcomment -%}
<script>
let progress_status_check; // this is the interval we'll set to track status on this problem

let probElem;
let numerator;
let denominator;
let SCORE;
let PREV_SCORE;

$(function() {

  // hide all exam messages
  function hideModals() {
    document.querySelectorAll('.message').forEach(function(msg) {
      msg.classList.add('hidden');
      msg.setAttribute('aria-hidden', true);
    });
  }

  // show specific exam messages
  function modalVisibility(step, courseType) {
    let elems;

    hideModals();

    if (courseType) {
      elems = document.querySelector('.' + step + '_modal.' + courseType);
    } else {
      elems = document.querySelector('.' + step + '_modal');
    }

    elems.forEach(function(elem) {
      elem.classList.remove('hidden');
      elem.setAttribute('aria-hidden', false);
    });
  }

  // this helper function gets a ton of information about the score for this particular problem
  // based on information embedded on this page
  var processScore = () => {
    const COURSE_TYPES = {
      FULL_COURSE: 'FULL_COURSE',
      GYM_SHORT: 'GYM_SHORT',
    };

    const COURSE_ID = parseInt(document.getElementById('__course_number__').innerText, 10);
    const COURSE_TYPE = COURSE_ID >= 100 ? COURSE_TYPES.FULL_COURSE : COURSE_TYPES.GYM_SHORT;
    let PASSING_SCORE = 85;

    if (COURSE_TYPE === COURSE_TYPES.FULL_COURSE) {
      // full courses have a passing grade of 85
      PASSING_SCORE = 85;
    } else {
      // gym shorts have a passing grade of 80
      PASSING_SCORE = 80;
    }

    probElem = document.querySelector('[data-problem-id]');
    numerator = Number(probElem.getAttribute('data-problem-score'));
    denominator = Number(probElem.getAttribute('data-problem-total-possible'));
    SCORE = Number(numerator / denominator * 100);
    let attempts_used = Number(document.getElementById('attempts-used').innerText);
    let attempts_total = Number(document.getElementById('attempts-allowed').innerText);
    let correct = numerator;
    let outOf = denominator;

    return {
      courseType: COURSE_TYPE,
      passingScore: PASSING_SCORE,
      score: SCORE,
      correct,
      outOf,
      attempts_used,
      attempts_total,
      attempts_remaining: attempts_total - attempts_used,
    };
  };

  var show_problem_progress = function() {
    let {
      attempts_used,
      attempts_total,
      attempts_remaining,
      correct,
      courseType,
      outOf,
      score,
      passingScore,
    } = processScore();

    if (!correct || !outOf) {
      return;
    }

    document.querySelector('.exam-score-container').innerText = SCORE;

    //we have a score
    if (score >= passingScore) {
      //we passed! show passing div for the type of course they took
      modalVisibility('passed', courseType);

      console.log('previous score: ', PREV_SCORE, 'score: ', SCORE, 'attempts remaining: ', attempts_remaining);

      //generate the certificate through the API
      $.ajax({
        type:     'POST',
        url:      '/accredible/request_certificate',
        async:     false,
        data:     {'course_id': window.$$course_id},
        success:  function(data) {
          console.log('[gym] certificate request successful: ', data);
        }
      });
    } else {
      console.log('[gym] failed, attempts remaining: ', attempts_remaining);
      //we failed :( see if we have another attempt
      if (attempts_remaining > 0) {
        modalVisibility('try_again', courseType);
      } else {
        modalVisibility('failed');
      }
    }
  }

  function check_status(){
    const {
      attempts_used,
      correct,
    } = processScore();

    if (attempts_used > 0 || correct > 0) {
      clearInterval(progress_status_check);
      show_problem_progress();
    }
  }

  // This determines if we are on the exam page?
  if ($('.problem-header').text().trim() === "Final Exam") {

    let problem_id = document.getElementById('exam-problem').getAttribute('data-id');

    probElem = document.querySelector('[data-problem-id');
    numerator = Number(probElem.getAttribute('data-problem-score'));
    denominator = Number(probElem.getAttribute('data-problem-total-possible'));
    SCORE = Number(numerator / denominator * 100);

    if (SCORE > 0) {
      PREV_SCORE = SCORE;
    } else {
      PREV_SCORE = 0;
    }

    console.log('[gym] exam page | problem id: ' + problem_id,
      'score: ', SCORE,
      'previous score: ', PREV_SCORE
    );

    let observer = new MutationObserver(mutationRecords => {
      // reset interval if we detect a grade change
      console.log('[gym] mutation records: ', mutationRecords);
      if (typeof progress_status_check !== 'undefined'){
        clearInterval(progress_status_check);
      }
      // set interval on initial page load
      progress_status_check = setInterval(check_status, 200);
    });

    observer.observe(
      document.getElementById(problem_id + '-problem-progress'),
      {
        characterData: false,
        attributes: false,
        childList: true,
        subtree: false
      },
    );
  } else {
    return;
  }

  // scroll to show the results message
  $('#check-button').on('click', function() {
    console.log('[gym] check exam button clicked');
    $('#course_passed_message')[0].scrollIntoView();
  });

});

</script>
